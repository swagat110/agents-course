<CourseFloatingBanner 
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/#fileId=https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/multiagent_notebook.ipynb"},
]}
askForHelpUrl="http://hf.co/join/discord" />

# ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ

ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œì€ **íŠ¹í™”ëœ ì—ì´ì „íŠ¸ë“¤ì´ í˜‘ë ¥í•˜ì—¬ ë³µì¡í•œ ì‘ì—…ì„ í•´ê²°**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ëª¨ë“ˆì„±, í™•ì¥ì„±, ê²¬ê³ ì„±ì„ ë†’ì—¬ì¤ë‹ˆë‹¤. ë‹¨ì¼ ì—ì´ì „íŠ¸ì— ì˜ì¡´í•˜ëŠ” ëŒ€ì‹ , ê°ê¸° ë‹¤ë¥¸ ëŠ¥ë ¥ì„ ê°€ì§„ ì—ì´ì „íŠ¸ë“¤ì´ ì‘ì—…ì„ ë¶„ë‹´í•©ë‹ˆë‹¤.

**smolagents**ì—ì„œëŠ” ë‹¤ì–‘í•œ ì—ì´ì „íŠ¸ë¥¼ ê²°í•©í•´ íŒŒì´ì¬ ì½”ë“œ ìƒì„±, ì™¸ë¶€ ë„êµ¬ í˜¸ì¶œ, ì›¹ ê²€ìƒ‰ ë“± ë‹¤ì–‘í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì—ì´ì „íŠ¸ë“¤ì„ ì¡°ìœ¨í•¨ìœ¼ë¡œì¨ ê°•ë ¥í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¼ë°˜ì ì¸ êµ¬ì„± ì˜ˆì‹œ:
- **ë§¤ë‹ˆì € ì—ì´ì „íŠ¸**: ì‘ì—… ë¶„ë°° ë‹´ë‹¹
- **ì½”ë“œ ì¸í„°í”„ë¦¬í„° ì—ì´ì „íŠ¸**: ì½”ë“œ ì‹¤í–‰ ë‹´ë‹¹
- **ì›¹ ê²€ìƒ‰ ì—ì´ì „íŠ¸**: ì •ë³´ ê²€ìƒ‰ ë‹´ë‹¹

ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì€ **ë§¤ë‹ˆì € ì—ì´ì „íŠ¸**ê°€ **ì½”ë“œ ì¸í„°í”„ë¦¬í„° ë„êµ¬**ì™€ **ì›¹ ê²€ìƒ‰ ì—ì´ì „íŠ¸**ë¥¼ ì¡°ìœ¨í•˜ëŠ” ê°„ë‹¨í•œ ë©€í‹° ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì›¹ ê²€ìƒ‰ ì—ì´ì „íŠ¸ëŠ” `DuckDuckGoSearchTool`ê³¼ `VisitWebpageTool` ê°™ì€ ë„êµ¬ë¥¼ í™œìš©í•´ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

<img src="https://mermaid.ink/img/pako:eNp1kc1qhTAQRl9FUiQb8wIpdNO76eKubrmFks1oRg3VSYgjpYjv3lFL_2hnMWQOJwn5sqgmelRWleUSKLAtFs09jqhtoWuYUFfFAa6QA9QDTnpzamheuhxn8pt40-6l13UtS0ddhtQXj6dbR4XUGQg6zEYasTF393KjeSDGnDJKNxzj8I_7hLW5IOSmP9CH9hv_NL-d94d4DVNg84p1EnK4qlIj5hGClySWbadT-6OdsrL02MI8sFOOVkciw8zx8kaNspxnrJQE0fXKtjBMMs3JA-MpgOQwftIE9Bzj14w-cMznI_39E9Z3p0uFoA?type=png" style='background: white;'>

## ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì‹¤ì „ ì˜ˆì‹œ

ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œì€ ì—¬ëŸ¬ íŠ¹í™” ì—ì´ì „íŠ¸ê°€ **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì—ì´ì „íŠ¸**ì˜ ì¡°ìœ¨ ì•„ë˜ í˜‘ë ¥í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ì—­í• ì´ ë‹¤ë¥¸ ì—ì´ì „íŠ¸ë“¤ì—ê²Œ ì‘ì—…ì„ ë¶„ì‚°ì‹œì¼œ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, **ë©€í‹° ì—ì´ì „íŠ¸ RAG ì‹œìŠ¤í…œ**ì€ ë‹¤ìŒì„ í†µí•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- **ì›¹ ì—ì´ì „íŠ¸**: ì¸í„°ë„· ë¸Œë¼ìš°ì§• ë‹´ë‹¹
- **ë¦¬íŠ¸ë¦¬ë²„ ì—ì´ì „íŠ¸**: ì§€ì‹ ë² ì´ìŠ¤ ì •ë³´ ê²€ìƒ‰ ë‹´ë‹¹
- **ì´ë¯¸ì§€ ìƒì„± ì—ì´ì „íŠ¸**: ì‹œê° ìë£Œ ìƒì„± ë‹´ë‹¹

ì´ ëª¨ë“  ì—ì´ì „íŠ¸ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ê°€ ì‘ì—… ë¶„ë°°ì™€ ìƒí˜¸ì‘ìš©ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

## ë©€í‹° ì—ì´ì „íŠ¸ ê³„ì¸µ êµ¬ì¡°ë¡œ ë³µì¡í•œ ë¬¸ì œ í•´ê²°í•˜ê¸°

<Tip>
<a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/multiagent_notebook.ipynb" target="_blank">ì´ ë…¸íŠ¸ë¶</a>ì„ ë”°ë¼ê°€ë©° ì½”ë“œë¥¼ ì§ì ‘ ì‹¤í–‰í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Tip>

ë¦¬ì…‰ì…˜ì´ ë‹¤ê°€ì˜¤ê³  ìˆìŠµë‹ˆë‹¤! ì—¬ëŸ¬ë¶„ì˜ ë„ì›€ìœ¼ë¡œ AlfredëŠ” ê±°ì˜ ëª¨ë“  ì¤€ë¹„ë¥¼ ë§ˆì³¤ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤: ë°°íŠ¸ëª¨ë¹Œì´ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤. AlfredëŠ” ëŒ€ì²´ ì°¨ëŸ‰ì„ ë¹¨ë¦¬ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.

ë‹¤í–‰íˆ ë¸Œë£¨ìŠ¤ ì›¨ì¸ì˜ ì‚¶ì„ ë‹¤ë£¬ ë°”ì´ì˜¤í”½ ì˜í™”ê°€ ëª‡ í¸ ì œì‘ë˜ì—ˆìœ¼ë‹ˆ, AlfredëŠ” ì˜í™” ì„¸íŠ¸ì¥ì— ë‚¨ê²¨ì§„ ì°¨ëŸ‰ì„ ì°¾ì•„ í˜„ëŒ€ì‹ìœ¼ë¡œ ê°œì¡°í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. ë¬¼ë¡  ììœ¨ì£¼í–‰ ê¸°ëŠ¥ë„ í•„ìˆ˜ê² ì£ .

í•˜ì§€ë§Œ ì´ ì°¨ëŸ‰ë“¤ì€ ì „ ì„¸ê³„ ì´¬ì˜ì§€ ì–´ë””ì—ë‚˜ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ AlfredëŠ” ì—¬ëŸ¬ë¶„ì˜ ë„ì›€ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ë³¼ê¹Œìš”?

> ğŸ‘‰ ì „ ì„¸ê³„ ë°°íŠ¸ë§¨ ì´¬ì˜ì§€ë¥¼ ëª¨ë‘ ì°¾ì•„, ê³ ë‹´(40.7128Â° N, 74.0060Â° W)ê¹Œì§€ í™”ë¬¼ì„ (ë¹„í–‰ê¸°)ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ê³„ì‚°í•˜ê³ , ì´ë¥¼ ì§€ë„ì— í‘œì‹œí•˜ì„¸ìš”. ì´ë™ ì‹œê°„ì— ë”°ë¼ ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ í•˜ê³ , ìŠˆí¼ì¹´ ê³µì¥ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš”.

í•¨ê»˜ ë§Œë“¤ì–´ë´…ì‹œë‹¤!

ì´ ì˜ˆì‹œì—ëŠ” ì¶”ê°€ íŒ¨í‚¤ì§€ê°€ í•„ìš”í•˜ë‹ˆ ë¨¼ì € ì„¤ì¹˜í•´ ì£¼ì„¸ìš”:

```bash
pip install 'smolagents[litellm]' plotly geopandas shapely kaleido -q
```

### ë¨¼ì € í™”ë¬¼ê¸° ì´ë™ ì‹œê°„ ê³„ì‚° ë„êµ¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.

```python
import math
from typing import Optional, Tuple

from smolagents import tool


@tool
def calculate_cargo_travel_time(
    origin_coords: Tuple[float, float],
    destination_coords: Tuple[float, float],
    cruising_speed_kmh: Optional[float] = 750.0,  # í™”ë¬¼ê¸° í‰ê·  ì†ë„
) -> float:
    """
    ë‘ ì§€ì (ìœ„ë„, ê²½ë„) ê°„ í™”ë¬¼ê¸° ì´ë™ ì‹œê°„ì„ ëŒ€ê¶Œê±°ë¦¬ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.

    Args:
        origin_coords: ì¶œë°œì§€ (ìœ„ë„, ê²½ë„) íŠœí”Œ
        destination_coords: ë„ì°©ì§€ (ìœ„ë„, ê²½ë„) íŠœí”Œ
        cruising_speed_kmh: ìˆœí•­ ì†ë„(km/h, ê¸°ë³¸ê°’ 750)

    Returns:
        float: ì˜ˆìƒ ì´ë™ ì‹œê°„(ì‹œê°„ ë‹¨ìœ„)

    Example:
        >>> # ì‹œì¹´ê³ (41.8781Â° N, 87.6298Â° W) â†’ ì‹œë“œë‹ˆ(33.8688Â° S, 151.2093Â° E)
        >>> result = calculate_cargo_travel_time((41.8781, -87.6298), (-33.8688, 151.2093))
    """

    def to_radians(degrees: float) -> float:
        return degrees * (math.pi / 180)

    # ì¢Œí‘œ ë³€í™˜
    lat1, lon1 = map(to_radians, origin_coords)
    lat2, lon2 = map(to_radians, destination_coords)

    # ì§€êµ¬ ë°˜ì§€ë¦„(km)
    EARTH_RADIUS_KM = 6371.0

    # haversine ê³µì‹ìœ¼ë¡œ ëŒ€ê¶Œê±°ë¦¬ ê³„ì‚°
    dlon = lon2 - lon1
    dlat = lat2 - lat1

    a = (
        math.sin(dlat / 2) ** 2
        + math.cos(lat1) * math.cos(lat2) * math.sin(dlon / 2) ** 2
    )
    c = 2 * math.asin(math.sqrt(a))
    distance = EARTH_RADIUS_KM * c

    # ìš°íšŒ ê²½ë¡œ, ê´€ì œ ë“± ê°ì•ˆí•´ 10% ì¶”ê°€
    actual_distance = distance * 1.1

    # ë¹„í–‰ ì‹œê°„ ê³„ì‚°(ì´ì°©ë¥™ 1ì‹œê°„ ì¶”ê°€)
    flight_time = (actual_distance / cruising_speed_kmh) + 1.0

    return round(flight_time, 2)


print(calculate_cargo_travel_time((41.8781, -87.6298), (-33.8688, 151.2093)))
```

### ì—ì´ì „íŠ¸ ì„¤ì •í•˜ê¸°

ëª¨ë¸ ì œê³µìëŠ” Together AIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. GoogleSearchToolì€ [Serper API](https://serper.dev)ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, í™˜ê²½ ë³€ìˆ˜ `SERPAPI_API_KEY`(provider="serpapi") ë˜ëŠ” `SERPER_API_KEY`(provider=serper)ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

Serp APIê°€ ì—†ë‹¤ë©´ `DuckDuckGoSearchTool`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì†ë„ ì œí•œì— ìœ ì˜í•˜ì„¸ìš”.

```python
import os
from PIL import Image
from smolagents import CodeAgent, GoogleSearchTool, InferenceClientModel, VisitWebpageTool

model = InferenceClientModel(model_id="Qwen/Qwen2.5-Coder-32B-Instruct", provider="together")
```

ê°„ë‹¨í•œ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ê¸°ë³¸ ë¦¬í¬íŠ¸ë¥¼ ë°›ì•„ë´…ì‹œë‹¤.

```python
task = """ì „ ì„¸ê³„ ë°°íŠ¸ë§¨ ì´¬ì˜ì§€ë¥¼ ëª¨ë‘ ì°¾ì•„, ê³ ë‹´(40.7128Â° N, 74.0060Â° W)ê¹Œì§€ í™”ë¬¼ê¸°ë¡œ ì´ë™í•˜ëŠ” ì‹œê°„ì„ ê³„ì‚°í•´ pandas ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”. ìŠˆí¼ì¹´ ê³µì¥ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í¬í•¨í•˜ì„¸ìš”."""
```

```python
agent = CodeAgent(
    model=model,
    tools=[GoogleSearchTool("serper"), VisitWebpageTool(), calculate_cargo_travel_time],
    additional_authorized_imports=["pandas"],
    max_steps=20,
)
```

```python
result = agent.run(task)
```

```python
result
```

ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ:

```python
|  | Location                                             | Travel Time to Gotham (hours) |
|--|------------------------------------------------------|------------------------------|
| 0  | Necropolis Cemetery, Glasgow, Scotland, UK         | 8.60                         |
| 1  | St. George's Hall, Liverpool, England, UK         | 8.81                         |
| 2  | Two Temple Place, London, England, UK             | 9.17                         |
| 3  | Wollaton Hall, Nottingham, England, UK           | 9.00                         |
| 4  | Knebworth House, Knebworth, Hertfordshire, UK    | 9.15                         |
| 5  | Acton Lane Power Station, Acton Lane, Acton, UK  | 9.16                         |
| 6  | Queensboro Bridge, New York City, USA            | 1.01                         |
| 7  | Wall Street, New York City, USA                  | 1.00                         |
| 8  | Mehrangarh Fort, Jodhpur, Rajasthan, India       | 18.34                        |
| 9  | Turda Gorge, Turda, Romania                      | 11.89                        |
| 10 | Chicago, USA                                     | 2.68                         |
| 11 | Hong Kong, China                                 | 19.99                        |
| 12 | Cardington Studios, Northamptonshire, UK        | 9.10                         |
| 13 | Warner Bros. Leavesden Studios, Hertfordshire, UK | 9.13                         |
| 14 | Westwood, Los Angeles, CA, USA                  | 6.79                         |
| 15 | Woking, UK (McLaren)                             | 9.13                         |
```

ê³„íš ë‹¨ê³„(planning step)ë¥¼ ì¶”ê°€í•˜ê³  í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ê°•í•˜ë©´ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê³„íš ë‹¨ê³„ëŠ” ì—ì´ì „íŠ¸ê°€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë¯¸ë¦¬ ìƒê°í•˜ê³  ê³„íší•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

```python
agent.planning_interval = 4

detailed_report = agent.run(f"""
ì—¬ëŸ¬ë¶„ì€ ì „ë¬¸ ë¶„ì„ê°€ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•´ ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
for ë£¨í”„ë¥¼ í™œìš©í•´ ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í•œ ë²ˆì— ê²€ìƒ‰í•˜ì„¸ìš”.
ê° ë°ì´í„° í¬ì¸íŠ¸ë§ˆë‹¤ ì†ŒìŠ¤ URLì„ ë°©ë¬¸í•´ ìˆ˜ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.

{task}
""")

print(detailed_report)
```

```python
detailed_report
```

ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ:

```python
|  | Location                                         | Travel Time (hours) |
|--|--------------------------------------------------|---------------------|
| 0  | Bridge of Sighs, Glasgow Necropolis, Glasgow, UK | 8.6                 |
| 1  | Wishart Street, Glasgow, Scotland, UK         | 8.6                 |
```

ì´ì²˜ëŸ¼ í”„ë¡¬í”„íŠ¸ì™€ ê³„íš ê¸°ëŠ¥ë§Œìœ¼ë¡œë„ í›¨ì”¬ ê°„ê²°í•œ ë¦¬í¬íŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ëª¨ë¸ì˜ ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš°ê°€ ë¹ ë¥´ê²Œ ì±„ì›Œì§‘ë‹ˆë‹¤. **ë”°ë¼ì„œ ìƒì„¸ ê²€ìƒ‰ ê²°ê³¼ì™€ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ê²°í•©í•˜ë„ë¡ ìš”ì²­í•˜ë©´ ëŠë ¤ì§€ê³  í† í°Â·ë¹„ìš©ì´ ê¸‰ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

â¡ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤.

### âœŒï¸ ë‘ ì—ì´ì „íŠ¸ë¡œ ì‘ì—… ë¶„í• í•˜ê¸°

ë©€í‹° ì—ì´ì „íŠ¸ êµ¬ì¡°ëŠ” ì„œë¡œ ë‹¤ë¥¸ í•˜ìœ„ ì‘ì—…ì˜ ë©”ëª¨ë¦¬ë¥¼ ë¶„ë¦¬í•´ ë‘ ê°€ì§€ í° ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤:
- ê° ì—ì´ì „íŠ¸ê°€ í•µì‹¬ ì‘ì—…ì— ì§‘ì¤‘í•´ ì„±ëŠ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.
- ë©”ëª¨ë¦¬ ë¶„ë¦¬ë¡œ ê° ë‹¨ê³„ì˜ ì…ë ¥ í† í° ìˆ˜ê°€ ì¤„ì–´, ì§€ì—°ê³¼ ë¹„ìš©ì´ ê°ì†Œí•©ë‹ˆë‹¤.

ì›¹ ê²€ìƒ‰ ì „ë‹´ ì—ì´ì „íŠ¸ì™€ ì´ë¥¼ ê´€ë¦¬í•˜ëŠ” ë§¤ë‹ˆì € ì—ì´ì „íŠ¸ë¡œ íŒ€ì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

ë§¤ë‹ˆì € ì—ì´ì „íŠ¸ëŠ” ìµœì¢… ë¦¬í¬íŠ¸ ì‘ì„±ì„ ìœ„í•´ ì¶”ê°€ import(`plotly`, `geopandas`, `shapely`)ê°€ í•„ìš”í•©ë‹ˆë‹¤.

```python
model = InferenceClientModel(
    "Qwen/Qwen2.5-Coder-32B-Instruct", provider="together", max_tokens=8096
)

web_agent = CodeAgent(
    model=model,
    tools=[
        GoogleSearchTool(provider="serper"),
        VisitWebpageTool(),
        calculate_cargo_travel_time,
    ],
    name="web_agent",
    description="ì›¹ì—ì„œ ì •ë³´ë¥¼ ì°¾ëŠ” ì—­í• ",
    verbosity_level=0,
    max_steps=10,
)
```

ë§¤ë‹ˆì € ì—ì´ì „íŠ¸ëŠ” ë” ê°•ë ¥í•œ ëª¨ë¸ [DeepSeek-R1](https://huggingface.co/deepseek-ai/DeepSeek-R1)ì„ ì‚¬ìš©í•˜ê³ , `planning_interval`ë„ ì¶”ê°€í•©ë‹ˆë‹¤.

```python
from smolagents.utils import encode_image_base64, make_image_url
from smolagents import OpenAIServerModel


def check_reasoning_and_plot(final_answer, agent_memory):
    multimodal_model = OpenAIServerModel("gpt-4o", max_tokens=8096)
    filepath = "saved_map.png"
    assert os.path.exists(filepath), "saved_map.png íŒŒì¼ì´ ì €ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤!"
    image = Image.open(filepath)
    prompt = (
        f"ë‹¤ìŒì€ ì‚¬ìš©ì ìš”ì²­ê³¼ ì—ì´ì „íŠ¸ ë‹¨ê³„ì…ë‹ˆë‹¤: {agent_memory.get_succinct_steps()}. ì•„ë˜ëŠ” ìƒì„±ëœ ì§€ë„ì…ë‹ˆë‹¤."
        "ì¶”ë¡  ê³¼ì •ê³¼ ì§€ë„ê°€ ìš”ì²­ì„ ì˜¬ë°”ë¥´ê²Œ í•´ê²°í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”."
        "ë¨¼ì € ì´ìœ ë¥¼ ë‚˜ì—´í•œ ë’¤, ìµœì¢… ê²°ì •(PASS/FAIL)ì„ ì‘ì„±í•˜ì„¸ìš”."
        "ë„ˆë¬´ ì—„ê²©í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ í•´ê²°í–ˆë‹¤ë©´ PASSì…ë‹ˆë‹¤."
        "ì§€ë„ëŠ” px.scatter_mapìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ PASSì…ë‹ˆë‹¤."
    )
    messages = [
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": prompt,
                },
                {
                    "type": "image_url",
                    "image_url": {"url": make_image_url(encode_image_base64(image))},
                },
            ],
        }
    ]
    output = multimodal_model(messages).content
    print("í”¼ë“œë°±: ", output)
    if "FAIL" in output:
        raise Exception(output)
    return True


manager_agent = CodeAgent(
    model=InferenceClientModel("deepseek-ai/DeepSeek-R1", provider="together", max_tokens=8096),
    tools=[calculate_cargo_travel_time],
    managed_agents=[web_agent],
    additional_authorized_imports=[
        "geopandas",
        "plotly",
        "shapely",
        "json",
        "pandas",
        "numpy",
    ],
    planning_interval=5,
    verbosity_level=2,
    final_answer_checks=[check_reasoning_and_plot],
    max_steps=15,
)
```

ì´ íŒ€ì˜ êµ¬ì¡°ë¥¼ ì‹œê°í™”í•´ë´…ì‹œë‹¤:

```python
manager_agent.visualize()
```

ì•„ë˜ì™€ ê°™ì´ êµ¬ì¡°ì™€ ë„êµ¬ ì‚¬ìš© ê´€ê³„ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python
CodeAgent | deepseek-ai/DeepSeek-R1
â”œâ”€â”€ âœ… Authorized imports: ['geopandas', 'plotly', 'shapely', 'json', 'pandas', 'numpy']
â”œâ”€â”€ ğŸ› ï¸ Tools:
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”‚   â”ƒ Name                        â”ƒ Description                           â”ƒ Arguments                             â”ƒ
â”‚   â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚   â”‚ calculate_cargo_travel_time â”‚ ë‘ ì§€ì  ê°„ í™”ë¬¼ê¸° ì´ë™ ì‹œê°„ ê³„ì‚°         â”‚ origin_coords (`array`): ì¶œë°œì§€ ì¢Œí‘œ   â”‚
â”‚   â”‚                             â”‚                                       â”‚ destination_coords (`array`): ë„ì°©ì§€   â”‚
â”‚   â”‚                             â”‚                                       â”‚ cruising_speed_kmh (`number`): ì†ë„    â”‚
â”‚   â”‚ final_answer                â”‚ ë¬¸ì œì— ëŒ€í•œ ìµœì¢… ë‹µë³€ ì œê³µ              â”‚ answer (`any`): ìµœì¢… ë‹µë³€              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€ ğŸ¤– Managed agents:
    â””â”€â”€ web_agent | CodeAgent | Qwen/Qwen2.5-Coder-32B-Instruct
        â”œâ”€â”€ âœ… Authorized imports: []
        â”œâ”€â”€ ğŸ“ Description: ì›¹ì—ì„œ ì •ë³´ë¥¼ ì°¾ëŠ” ì—­í• 
        â””â”€â”€ ğŸ› ï¸ Tools:
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
            â”ƒ Name                        â”ƒ Description                       â”ƒ Arguments                         â”ƒ
            â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
            â”‚ web_search                  â”‚ êµ¬ê¸€ ì›¹ ê²€ìƒ‰ ìˆ˜í–‰                  â”‚ query (`string`): ê²€ìƒ‰ì–´           â”‚
            â”‚                             â”‚                                   â”‚ filter_year (`integer`): ì—°ë„ ì œí•œ â”‚
            â”‚ visit_webpage               â”‚ ì›¹í˜ì´ì§€ ë°©ë¬¸ ë° ë‚´ìš© ì½ê¸°         â”‚ url (`string`): ë°©ë¬¸í•  URL         â”‚
            â”‚ calculate_cargo_travel_time â”‚ ë‘ ì§€ì  ê°„ í™”ë¬¼ê¸° ì´ë™ ì‹œê°„ ê³„ì‚°   â”‚ origin_coords (`array`): ì¶œë°œì§€     â”‚
            â”‚                             â”‚                                   â”‚ destination_coords (`array`): ë„ì°©ì§€â”‚
            â”‚                             â”‚                                   â”‚ cruising_speed_kmh (`number`): ì†ë„ â”‚
            â”‚ final_answer                â”‚ ë¬¸ì œì— ëŒ€í•œ ìµœì¢… ë‹µë³€ ì œê³µ         â”‚ answer (`any`): ìµœì¢… ë‹µë³€           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
manager_agent.run("""
ì „ ì„¸ê³„ ë°°íŠ¸ë§¨ ì´¬ì˜ì§€ë¥¼ ëª¨ë‘ ì°¾ì•„, ê³ ë‹´(40.7128Â° N, 74.0060Â° W)ê¹Œì§€ í™”ë¬¼ê¸°ë¡œ ì´ë™í•˜ëŠ” ì‹œê°„ì„ ê³„ì‚°í•˜ì„¸ìš”. ìŠˆí¼ì¹´ ê³µì¥ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í¬í•¨í•´ ì´ 6ê°œ ì´ìƒ ì§€ì ì„ ì§€ë„ì— ì‚°ì ë„ë¡œ í‘œì‹œí•˜ê³ , ì´ë™ ì‹œê°„ì— ë”°ë¼ ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ í•˜ì„¸ìš”. ê²°ê³¼ ì´ë¯¸ì§€ëŠ” saved_map.pngë¡œ ì €ì¥í•˜ì„¸ìš”!

ì§€ë„ ì˜ˆì‹œ:
import plotly.express as px
df = px.data.carshare()
fig = px.scatter_map(df, lat="centroid_lat", lon="centroid_lon", text="name", color="peak_hour", size=100,
     color_continuous_scale=px.colors.sequential.Magma, size_max=15, zoom=1)
fig.show()
fig.write_image("saved_image.png")
final_answer(fig)

ë¬¸ìì—´ì„ ì½”ë“œë¡œ ì²˜ë¦¬í•˜ì§€ ë§ˆì„¸ìš”. ë¬¸ìì—´ì´ ìˆìœ¼ë©´ printë¡œ ì¶œë ¥í•˜ì„¸ìš”.
""")
```

ì œ ì‹¤í–‰ì—ì„œëŠ” ë§¤ë‹ˆì € ì—ì´ì „íŠ¸ê°€ ì›¹ ì—ì´ì „íŠ¸ì—ê²Œ `1. ë°°íŠ¸ë§¨ ì´¬ì˜ì§€ ê²€ìƒ‰`, `2. ìŠˆí¼ì¹´ ê³µì¥ ì°¾ê¸°`ë¡œ ì‘ì—…ì„ ë¶„ë°°í•œ ë’¤, ê²°ê³¼ë¥¼ ì§‘ê³„í•´ ì§€ë„ë¥¼ ê·¸ë ¸ìŠµë‹ˆë‹¤.

ì—ì´ì „íŠ¸ ìƒíƒœì—ì„œ ì§€ë„ë¥¼ ì§ì ‘ í™•ì¸í•´ë´…ì‹œë‹¤:

```python
manager_agent.python_executor.state["fig"]
```

ì•„ë˜ì™€ ê°™ì´ ì§€ë„ê°€ ì¶œë ¥ë©ë‹ˆë‹¤:

![ë©€í‹°ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì˜ˆì‹œ ì¶œë ¥ ì§€ë„](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/output_map.png)

## ì°¸ê³  ìë£Œ

- [ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ](https://huggingface.co/docs/smolagents/main/en/examples/multiagents) â€“ ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ê°œìš”
- [Agentic RAGë€?](https://weaviate.io/blog/what-is-agentic-rag) â€“ Agentic RAG ì†Œê°œ
- [Multi-Agent RAG System ğŸ¤–ğŸ¤ğŸ¤– ë ˆì‹œí”¼](https://huggingface.co/learn/cookbook/multiagent_rag_system) â€“ ë‹¨ê³„ë³„ êµ¬ì¶• ê°€ì´ë“œ
